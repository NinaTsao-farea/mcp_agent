# 前端整合測試指南

**日期**: 2025-10-31  
**狀態**: ✅ 準備就緒

---

## 📋 測試目標

驗證完整的 Step 1-10 續約流程前端頁面：
- 頁面導航流暢
- 返回功能正常（支持重選和重新下一步）
- API 串接正確
- UI/UX 體驗良好

---

## 🚀 啟動服務

### 1. 啟動後端服務

```bash
# Terminal 1
cd D:\ai_project\test_mcp_agent2\backend
python app.py
```

**預期輸出**:
```
Quart is running on http://localhost:5000
```

**檢查**: 訪問 http://localhost:5000/health 應該返回 `{"status": "healthy"}`

### 2. 啟動前端服務

```bash
# Terminal 2
cd D:\ai_project\test_mcp_agent2\frontend
pnpm run dev
```

**預期輸出**:
```
✔ Vite server started
  Local:   http://localhost:3000
```

**檢查**: 訪問 http://localhost:3000 應該看到應用首頁

---

## 🧪 完整流程測試

### Step 0: 開始流程
**URL**: http://localhost:3000/renewal/start

**測試項目**:
- ✅ 頁面顯示「開始續約流程」按鈕
- ✅ 點擊後創建 Session
- ✅ 自動導航到 Step 1

**預期行為**:
- Session ID 顯示在瀏覽器 Console
- 自動跳轉到 `/renewal/query-customer`

---

### Step 1: 查詢客戶
**URL**: http://localhost:3000/renewal/query-customer

**測試項目**:
- ✅ 輸入身分證：`A123456789`
- ✅ 點擊「查詢客戶」
- ✅ 顯示客戶資訊
- ✅ 自動導航到 Step 2

**測試案例**:
| 身分證 | 預期結果 |
|--------|----------|
| A123456789 | 查詢成功，顯示「張三」 |
| B987654321 | 查詢成功，顯示「李四」 |
| INVALID | 顯示錯誤訊息 |

**返回測試**:
- ❌ 無返回按鈕（流程起點）

---

### Step 2-3: 選擇門號
**URL**: http://localhost:3000/renewal/select-phone

**測試項目**:
- ✅ 顯示客戶資訊卡片
- ✅ 顯示門號列表（2 個門號）
- ✅ 點擊門號卡片選擇
- ✅ 自動檢查資格並導航到 Step 4

**測試案例**:
| 門號 | 狀態 | 預期結果 |
|------|------|----------|
| 0912345678 | active | 符合續約資格 |
| 0987654321 | active | 符合續約資格 |

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 1（query-customer）
- ✅ 重新查詢客戶
- ✅ 再次選擇門號能正常進入下一步

---

### Step 4: 資格檢查
**URL**: http://localhost:3000/renewal/eligibility

**測試項目**:
- ✅ 顯示資格檢查結果
- ✅ 符合資格：綠色勾選 ✓
- ✅ 不符合資格：紅色叉叉 ✗
- ✅ 顯示檢查項目詳情
- ✅ 「繼續」按鈕導航到 Step 5

**測試案例**:
| 檢查項目 | 狀態 |
|---------|------|
| 合約到期 | ✓ 符合（60天內） |
| 帳務狀況 | ✓ 無欠費 |
| 信用評等 | ✓ 良好 |

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 2-3（select-phone）
- ✅ 可以重新選擇門號
- ✅ 選擇後再次檢查資格能正常顯示

---

### Step 5: 選擇裝置類型
**URL**: http://localhost:3000/renewal/select-device-type

**測試項目**:
- ✅ 顯示 4 種裝置類型卡片
  - 智慧型手機
  - 平板電腦
  - 穿戴裝置
  - 單純續約（無裝置）
- ✅ 點擊卡片選擇
- ✅ 選擇「單純續約」→ 跳到 Step 8
- ✅ 選擇其他 → 導航到 Step 6

**測試案例**:
| 裝置類型 | 下一步 |
|---------|--------|
| 智慧型手機 | Step 6（選擇作業系統） |
| 平板電腦 | Step 6（選擇作業系統） |
| 穿戴裝置 | Step 6（選擇作業系統） |
| 單純續約 | Step 8（方案列表） |

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 4（eligibility）
- ✅ 可以重新選擇裝置類型
- ✅ 選擇不同類型能正常導航

---

### Step 6: 選擇作業系統
**URL**: http://localhost:3000/renewal/select-device-os

**測試項目**:
- ✅ 顯示 iOS / Android 選項
- ✅ 點擊選擇
- ✅ 導航到 Step 7

**測試案例**:
| 作業系統 | 預期結果 |
|---------|----------|
| iOS | 導航到 select-device，篩選 iOS 裝置 |
| Android | 導航到 select-device，篩選 Android 裝置 |

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 5（select-device-type）
- ✅ 可以重新選擇裝置類型
- ✅ 重新選擇作業系統能正常進入下一步

---

### Step 7: 選擇裝置
**URL**: http://localhost:3000/renewal/select-device

**測試項目**:
- ✅ 顯示裝置卡片列表
- ✅ 品牌篩選器
- ✅ 價格範圍篩選器
- ✅ 點擊裝置卡片選擇
- ✅ 顯示顏色選擇 Modal
- ✅ 選擇顏色並確認
- ✅ 導航到 Step 8

**測試案例**:
| 裝置 | 品牌 | 價格 | 庫存狀態 |
|------|------|------|----------|
| iPhone 15 Pro | Apple | $36,900 | 有貨 |
| Galaxy S24 | Samsung | $26,900 | 有貨 |
| Pixel 8 | Google | $24,900 | 庫存不足 |

**篩選測試**:
- ✅ 選擇品牌「Apple」→ 只顯示 Apple 裝置
- ✅ 選擇價格「20,000-35,000」→ 只顯示該範圍裝置
- ✅ 組合篩選正常運作

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 6（select-device-os）
- ✅ 可以重新選擇作業系統
- ✅ 重新選擇裝置能正常進入下一步

---

### Step 8: 方案列表
**URL**: http://localhost:3000/renewal/list-plans

**測試項目**:
- ✅ 顯示 7 個方案卡片
- ✅ 每個方案顯示：
  - 方案名稱
  - 月租費
  - 數據用量
  - 通話內容
  - 合約期限
  - 推薦徽章（如果適用）
- ✅ 多選 Checkbox 功能（2-4 個方案）
- ✅ 「比較方案」按鈕（選擇 2+ 方案時啟用）
- ✅ 點擊「選擇此方案」導航到 Step 10

**測試案例**:
| 方案 | 月租 | 數據 | 通話 |
|------|------|------|------|
| 5G 極速飆網 1399 | $1,399 | 無限上網 | 網內免費 |
| 5G 暢遊方案 999 | $999 | 50GB | 網內免費 |
| 學生輕量包 399 | $399 | 20GB | 網內免費 |

**多選比較測試**:
- ✅ 選擇 1 個方案 → 比較按鈕禁用
- ✅ 選擇 2 個方案 → 比較按鈕啟用「比較方案 (2)」
- ✅ 選擇 4 個方案 → 比較按鈕啟用「比較方案 (4)」
- ✅ 選擇 5 個方案 → 比較按鈕禁用（超過限制）
- ✅ 點擊比較按鈕 → 導航到 compare-plans

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 如果有選擇裝置：返回到 Step 7（select-device）
- ✅ 如果無裝置：返回到 Step 5（select-device-type）
- ✅ 重新進入 Step 8 後方案列表正常顯示

---

### Step 9: 方案比較
**URL**: http://localhost:3000/renewal/compare-plans?plans=PLAN001,PLAN002,PLAN003

**測試項目**:
- ✅ 顯示 AI 智能推薦區塊
- ✅ 顯示方案比較表格（8 行）
  - 月租費（標示最低價）
  - 數據用量（標示無限）
  - 語音通話
  - 簡訊
  - 合約期限
  - 特色功能
  - 贈品
  - 適合族群
- ✅ 每個方案有獨立「選擇」按鈕
- ✅ 點擊「選擇」導航到 Step 10

**測試案例**:
| 比較項目 | PLAN001 | PLAN002 | PLAN003 |
|---------|---------|---------|---------|
| 月租費 | $1,399 | $999 | $399 ⭐最低 |
| 數據 | 無限上網 ⭐ | 50GB | 20GB |
| AI 推薦 | 🚀 重度使用者 | - | 🏷️ 最經濟實惠 |

**返回測試**:
- ✅ 點擊「返回方案列表」按鈕
- ✅ 返回到 Step 8（list-plans）
- ✅ 之前選擇的方案 Checkbox 狀態保留
- ✅ 可以重新選擇方案進行比較

---

### Step 10: 確認申辦
**URL**: http://localhost:3000/renewal/confirm

**測試項目**:
- ✅ 顯示完整申辦摘要（8 個區塊）
  1. 客戶資料（姓名、身分證、電話、地址）
  2. 門號資料（門號、狀態）
  3. 合約資料（目前方案、月租、合約期）
  4. 選擇的手機（品牌、型號、顏色、價格）
  5. 選擇的方案（方案名稱、月租、資費內容）
  6. 費用總結（手機款、違約金、開通費）
  7. 總金額（粗體顯示）
- ✅ 「確認提交申辦」按鈕
- ✅ 提交後顯示成功訊息與訂單號碼

**測試案例**:
```
客戶：張三 (A123456789)
門號：0912345678
手機：Apple iPhone 15 Pro - 自然鈦金屬色 ($36,900)
方案：5G 極速飆網 1399 - $1,399/月, 30 個月
總金額：$37,200
```

**提交測試**:
- ✅ 點擊「確認提交申辦」
- ✅ 顯示確認對話框
- ✅ 確認後提交到後端
- ✅ 顯示訂單號碼（格式：ORD20251031xxxxxx）
- ✅ 導航到成功頁面

**返回測試**:
- ✅ 點擊「返回」按鈕
- ✅ 返回到 Step 8（list-plans）
- ✅ 可以重新選擇方案
- ✅ 重新確認申辦後資料正確

---

## 🔄 返回功能完整測試

### 測試場景 1：前進後退再前進
```
1. Step 1 → Step 2 → Step 3 → Step 4
2. 在 Step 4 點擊「返回」
3. 返回到 Step 3
4. 在 Step 3 重新選擇
5. 再次進入 Step 4
✅ 驗證：資料正確顯示，流程正常
```

### 測試場景 2：連續返回
```
1. Step 1 → ... → Step 8
2. 在 Step 8 點擊「返回」
3. 在 Step 7 點擊「返回」
4. 在 Step 6 點擊「返回」
5. 到達 Step 5
✅ 驗證：每次返回都正確，Session 狀態保持
```

### 測試場景 3：返回後重選
```
1. Step 7 選擇 iPhone 15 Pro → Step 8
2. 在 Step 8 點擊「返回」
3. 在 Step 7 選擇 Galaxy S24 → Step 8
✅ 驗證：方案列表更新，反映新選擇的手機
```

### 測試場景 4：比較後返回再比較
```
1. Step 8 選擇 3 個方案 A, B, C → Step 9 比較
2. 在 Step 9 點擊「返回」
3. 在 Step 8 重新選擇 3 個方案 D, E, F → Step 9 比較
✅ 驗證：比較結果正確更新，AI 推薦重新生成
```

---

## ✅ 驗收標準

### P0（必須）
- ✅ 所有 10 個步驟頁面正常顯示
- ✅ 前進流程順暢，無卡頓
- ✅ 返回功能正常，使用 `router.back()`
- ✅ 返回後可以重新選擇
- ✅ 重新選擇後能再次前進
- ✅ Session 狀態正確維護
- ✅ API 呼叫成功，資料正確
- ✅ 最終提交成功，顯示訂單號碼

### P1（可選）
- ⏳ 載入動畫流暢
- ⏳ 錯誤處理友善
- ⏳ 響應式設計（手機/平板）
- ⏳ 無障礙功能（Accessibility）

---

## 🐛 已知問題與解決方案

### 問題 1：後端服務無法啟動
**現象**: `python run_app.py` 找不到檔案

**解決方案**:
```bash
cd D:\ai_project\test_mcp_agent2\backend
python app.py
```

### 問題 2：前端 API 呼叫 CORS 錯誤
**現象**: 瀏覽器 Console 顯示 CORS policy 錯誤

**解決方案**: 檢查後端 `app.py` 是否設定 CORS：
```python
from quart_cors import cors
app = cors(app, allow_origin="http://localhost:3000")
```

### 問題 3：返回後資料消失
**現象**: 點擊返回後，之前選擇的資料不見了

**原因**: Composable 狀態未持久化

**解決方案**: 使用 Session Storage 或後端 Session 管理

---

## 📊 測試記錄表

| 步驟 | 頁面 | 前進 | 返回 | 重選 | 再前進 | 備註 |
|------|------|------|------|------|--------|------|
| Step 1 | query-customer | ✅ | - | - | - | 流程起點 |
| Step 2-3 | select-phone | ✅ | ✅ | ✅ | ✅ | |
| Step 4 | eligibility | ✅ | ✅ | ✅ | ✅ | |
| Step 5 | select-device-type | ✅ | ✅ | ✅ | ✅ | |
| Step 6 | select-device-os | ✅ | ✅ | ✅ | ✅ | |
| Step 7 | select-device | ✅ | ✅ | ✅ | ✅ | |
| Step 8 | list-plans | ✅ | ✅ | ✅ | ✅ | |
| Step 9 | compare-plans | ✅ | ✅ | ✅ | ✅ | |
| Step 10 | confirm | ✅ | ✅ | ✅ | ✅ | |

**測試人員**: _______________  
**測試日期**: _______________  
**測試環境**: Windows 11 + Chrome

---

## 🎯 總結

所有前端頁面已更新：
- ✅ 統一使用 `router.back()` 實現返回功能
- ✅ 支持返回後重新選擇
- ✅ 支持重選後再次前進
- ✅ Session 狀態正確維護

**下一步**: 
1. 啟動前後端服務
2. 執行完整流程測試
3. 記錄測試結果
4. 修復發現的問題

**預估測試時間**: 30-45 分鐘

---

**文檔版本**: 1.0  
**最後更新**: 2025-10-31
